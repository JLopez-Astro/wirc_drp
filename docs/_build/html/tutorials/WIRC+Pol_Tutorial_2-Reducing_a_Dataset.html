

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tutorial 2: WIRC+Pol Dataset Reduction Tutorial &mdash; WIRC+Pol DRP  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tutorial 3: WIRC+Pol Modulation Sequence Tutorial" href="WIRC+Pol_Tutorial_3-Reducing_a_Modulation_Sequence.html" />
    <link rel="prev" title="Tutorial 1: WIRC+POL Single File Data Reduction" href="WIRC+Pol_Tutorial_1-Single_File_Spectral_Extraction.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> WIRC+Pol DRP
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../usage/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="WIRC+Pol_Tutorial_1-Single_File_Spectral_Extraction.html">Tutorial 1: WIRC+POL Single File Data Reduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial 2: WIRC+Pol Dataset Reduction Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#This-Tutorial">This Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="#The-Recipe">The Recipe</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Step-0---Read-in-the-calibration-files">Step 0 - Read in the calibration files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Step-1---Read-in-and-calibrate-your-data">Step 1 - Read in and calibrate your data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Now-it’s-your-turn-to-set-up-a-loop-to-calibrate-the-brown-dwarf-data!">Now it’s your turn to set up a loop to calibrate the brown dwarf data!</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Step-2:-Source-identification">Step 2: Source identification</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Step-3-4:-Background-subtraction-and-spectral-extraction">Step 3-4: Background subtraction and spectral extraction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Now-with-Steps-2-4-demonstrated-for-one-file,-let’s-run-it-all-on-all-files:-First-with-the-unpolarized-standard-star">Now with Steps 2-4 demonstrated for one file, let’s run it all on all files: First with the unpolarized standard star</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Then-the-brown-dwarf">Then the brown dwarf</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Step-5---Stack-the-spectra">Step 5 - Stack the spectra</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Now-do-the-same-for-the-brown-dwarf">Now do the same for the brown dwarf</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Step-6:-Polarization-calibration-and-calculation">Step 6: Polarization calibration and calculation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Acknowledgement">Acknowledgement</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="WIRC+Pol_Tutorial_3-Reducing_a_Modulation_Sequence.html">Tutorial 3: WIRC+Pol Modulation Sequence Tutorial</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">WIRC+Pol DRP</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Tutorial 2: WIRC+Pol Dataset Reduction Tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/WIRC+Pol_Tutorial_2-Reducing_a_Dataset.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Tutorial-2:-WIRC+Pol-Dataset-Reduction-Tutorial">
<h1>Tutorial 2: WIRC+Pol Dataset Reduction Tutorial<a class="headerlink" href="#Tutorial-2:-WIRC+Pol-Dataset-Reduction-Tutorial" title="Permalink to this headline">¶</a></h1>
<p>Welcome to the WIRC+Pol dataset reduction pipeline (DRP) tutorial. The notebook will give you a basic run through of how to reduce a set of WIRC+Pol data. It assumes that you have already completed the <strong>WIRC+Pol_Tutorial_1-Single_File_Spectral_Extraction</strong> tutorial, which also goes through how to make calibration files.</p>
<div class="section" id="This-Tutorial">
<h2>This Tutorial<a class="headerlink" href="#This-Tutorial" title="Permalink to this headline">¶</a></h2>
<p>This tutorial will give an example of reducing a set of raw WIRC+Pol data images from start to finish, and will give you an idea of the implementation of the pipeline along the way. We’ll note that many of the later data reduction steps (e.g. spectral extraction) are works in progress, and so the final data products should not yet be used for science. The purpose of this tutorial is more to demonstrate the features of the pipeline rather than to teach you how to fully calibrate your data.</p>
<p>In this tutorial we reduce two datasets: an unpolarized standard, and a brown dwarf. Each dataset has several files to read in and process.</p>
</div>
<div class="section" id="The-Recipe">
<h2>The Recipe<a class="headerlink" href="#The-Recipe" title="Permalink to this headline">¶</a></h2>
<p>There are several steps to reducing polarimetric data, some in common with typical photometry data reduction and some not. Here is a brief list of steps. Steps (1) through (4) are demonstrated for a single file in the <em>Single_File</em> tutorial. <strong>If you have data from after March 2019, after step (5), you’ll want to check out the “WIRC+Pol_Tutorial_3-Reducing_a_Modulation_Sequence” tutorial which goes over how to deal with data taken in sequence with the modulator.</strong></p>
<p>Here are the steps:</p>
<ol class="arabic simple">
<li><p>Correct for detector dark current and pixel-to-pixel variation by subtracting dark and dividing flat.</p></li>
<li><p>Source identification. The DRP has a capability to detect a source in the image. Alternatively, the pixel coordinates of the source can be manually entered. The DRP then grabs the 4 spectral traces associated with the source from the calibrated science image.</p></li>
<li><p>Subtract background from the data. There are multiple ways to do this, but in this tutorial we will simply use the shifted science image for background subtraction.</p></li>
<li><p>Spectral extraction. In this step we extract 1D spectra from the 4 spectral traces, which correspond to 4 different linear polarization angles. After finishing steps (2) to (4) for both the unpolarized standard star and the source, you can proceed to the next step.</p></li>
<li><p>Stack spectra. We can now combine the whole observing sequence to increase SNR before we compute the polarization.</p></li>
<li><p>Polarimetric calibration. Raw polarization measurements from WIRC+Pol are incorrect by several percent, but we can remove this offset by an observation of a known unpolarized star. We apply the correction in this step to measure polarization intrinsic to the source.</p></li>
</ol>
<div class="section" id="Step-0---Read-in-the-calibration-files">
<h3>Step 0 - Read in the calibration files<a class="headerlink" href="#Step-0---Read-in-the-calibration-files" title="Permalink to this headline">¶</a></h3>
<p>The very first step will be to create your own master darks and master flats, for that see the <em>Single_File</em> tutorial. For the sake of this tutorial we well assume that you have done this already. Already-made master darks and flats have been provided in the tutorial directory.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Import the important things</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
<span class="kn">import</span> <span class="nn">wirc_drp.wirc_object</span> <span class="k">as</span> <span class="nn">wo</span>
<span class="kn">from</span> <span class="nn">wirc_drp.utils</span> <span class="kn">import</span> <span class="n">calibration</span><span class="p">,</span> <span class="n">spec_utils</span> <span class="k">as</span> <span class="n">su</span><span class="p">,</span> <span class="n">image_utils</span> <span class="k">as</span> <span class="n">iu</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">astropy.io.ascii</span> <span class="k">as</span> <span class="nn">asci</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">shift</span>
<span class="kn">import</span> <span class="nn">glob</span>

<span class="kn">import</span> <span class="nn">warnings</span><span class="p">;</span> <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">tutorial_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>For this Tutorial, we will use pre-processed calibration files</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;./sample_data/&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">flat_name</span> <span class="o">=</span> <span class="s1">&#39;wirc0627_master_flat.fits&#39;</span>
<span class="n">bp_name</span> <span class="o">=</span> <span class="s1">&#39;wirc0627_bp_map.fits&#39;</span>
<span class="n">dark_name1s_10</span> <span class="o">=</span> <span class="s1">&#39;wirc0648_master_dark.fits&#39;</span> <span class="c1">#A dark with a 1s exposure time, 10-coadd</span>
<span class="n">dark_name60s_1</span> <span class="o">=</span> <span class="s1">&#39;wirc0711_master_dark.fits&#39;</span> <span class="c1">#A dark with a 60s exposure time, 1 coadd</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Step-1---Read-in-and-calibrate-your-data">
<h3>Step 1 - Read in and calibrate your data<a class="headerlink" href="#Step-1---Read-in-and-calibrate-your-data" title="Permalink to this headline">¶</a></h3>
<p>Assuming that you now have a master dark and master flat file, we can now read in a wirc_data file and perform the calibration.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#First we&#39;ll set up all the directories and filenames:</span>
<span class="n">unpol_filelist</span> <span class="o">=</span> <span class="s1">&#39;HD11639_sci.list&#39;</span> <span class="c1">#for the unpolarized standard</span>
<span class="c1">#source_filelist = &#39;SIMP0136_sci.list&#39; #for the source, the brown dwarf here</span>

<span class="c1">#Read in the file names</span>
<span class="n">unpol_fnames</span>  <span class="o">=</span> <span class="n">asci</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">unpol_filelist</span> <span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;fast_no_header&#39;</span><span class="p">)[</span><span class="s1">&#39;col1&#39;</span><span class="p">]</span>
<span class="c1">#source_fnames = asci.read(source_filelist, format = &#39;fast_no_header&#39;)[&#39;col1&#39;]</span>
</pre></div>
</div>
</div>
<p>First we deal with the unpolarized standard star. We will demonstrate the process for one file, then loop through and calibrate everything.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Choose dark with the correct exposure time here</span>
<span class="n">dark_fn</span> <span class="o">=</span> <span class="n">dark_name1s_10</span>
<span class="c1">#Then select flat and bad pixels map</span>
<span class="n">flat_fn</span> <span class="o">=</span> <span class="n">flat_name</span>
<span class="n">bp_fn</span>   <span class="o">=</span> <span class="n">bp_name</span>

<span class="c1">#Now we&#39;ll create the wirc_data object, passing in the filenames for the master dark, flat and bad pixel maps</span>
<span class="n">raw_data</span> <span class="o">=</span> <span class="n">wo</span><span class="o">.</span><span class="n">wirc_data</span><span class="p">(</span><span class="n">raw_filename</span><span class="o">=</span><span class="n">unpol_fnames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">flat_fn</span> <span class="o">=</span> <span class="n">flat_fn</span><span class="p">,</span> <span class="n">dark_fn</span> <span class="o">=</span> <span class="n">dark_fn</span><span class="p">,</span> <span class="n">bp_fn</span> <span class="o">=</span> <span class="n">bp_fn</span><span class="p">,</span>
                       <span class="n">ref_lib</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;/home/mmnguyen/Research/WIRC+POL/Data/2018421/Sky/*.fits&#39;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Creating a new wirc_data object from file wirc0140.fits
Found a J-band filter in the header of file wirc0140.fits
</pre></div></div>
</div>
<p>Let’s run the calibration step. It will subtract the dark, divide by the flat, and interpolate over the bad pixels.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">raw_data</span><span class="o">.</span><span class="n">calibrate</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/maxwellmb/Dropbox (Personal)/Library/Python/wirc_drp/wirc_drp/wirc_object.py:220: RuntimeWarning: divide by zero encountered in true_divide
  self.full_image = self.full_image/master_flat
/Users/maxwellmb/Dropbox (Personal)/Library/Python/wirc_drp/wirc_drp/wirc_object.py:220: RuntimeWarning: invalid value encountered in true_divide
  self.full_image = self.full_image/master_flat
/Users/maxwellmb/Dropbox (Personal)/Library/Python/wirc_drp/wirc_drp/utils/calibration.py:734: RuntimeWarning: invalid value encountered in less_equal
  bad_pixel_map = np.logical_or(bad_pixel_map, redux_science &lt;= 0)
</pre></div></div>
</div>
<p>What does it look like?</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">raw_data</span><span class="o">.</span><span class="n">full_image</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">origin</span> <span class="o">=</span> <span class="s1">&#39;lower&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.image.AxesImage at 0x1c1f8569b0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_14_1.png" src="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_14_1.png" />
</div>
</div>
<p>There are a few remaining artifacts in the image, but overall, not bad!</p>
<p>Now we can loop through all the files and calibrate them!</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">######Set the calibration output directory. Set this up for your own group!!!#####</span>
<span class="n">calib_dir</span> <span class="o">=</span> <span class="n">tutorial_dir</span><span class="o">+</span><span class="s1">&#39;/sample_data/&#39;</span>

<span class="n">unpol_calibrated_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="c1">#This is a list of the calibrated files.</span>

<span class="c1">#Read in the file names</span>
<span class="n">unpol_fnames</span>  <span class="o">=</span> <span class="n">asci</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">unpol_filelist</span> <span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;fast_no_header&#39;</span><span class="p">)[</span><span class="s1">&#39;col1&#39;</span><span class="p">]</span>
<span class="c1">#source_fnames = asci.read(source_filelist, format = &#39;fast_no_header&#39;)[&#39;col1&#39;]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unpol_fnames</span><span class="p">):</span>
    <span class="c1">#open the file</span>
    <span class="n">raw_data</span> <span class="o">=</span> <span class="n">wo</span><span class="o">.</span><span class="n">wirc_data</span><span class="p">(</span><span class="n">raw_filename</span><span class="o">=</span><span class="n">unpol_fnames</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">flat_fn</span> <span class="o">=</span> <span class="n">flat_fn</span><span class="p">,</span> <span class="n">dark_fn</span> <span class="o">=</span> <span class="n">dark_fn</span><span class="p">,</span> <span class="n">bp_fn</span> <span class="o">=</span> <span class="n">bp_fn</span><span class="p">)</span>
    <span class="c1">#run the calibration</span>
    <span class="n">raw_data</span><span class="o">.</span><span class="n">calibrate</span><span class="p">()</span>
    <span class="c1">#file name of the calibrated file</span>
    <span class="n">outname</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_calib.fits&#39;</span>
    <span class="c1">#add to the list and save it</span>
    <span class="n">unpol_calibrated_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unpol_calibrated_list</span><span class="p">,</span> <span class="n">calib_dir</span><span class="o">+</span><span class="n">outname</span><span class="p">)</span>
    <span class="n">raw_data</span><span class="o">.</span><span class="n">save_wirc_object</span><span class="p">(</span><span class="n">calib_dir</span><span class="o">+</span><span class="n">outname</span><span class="p">)</span>

<span class="c1">###You may want to save the list, for late use, here&#39;s an example how:</span>
<span class="c1"># np.save(calib_dir+&#39;unpol_calibrated_list.npy&#39;, unpol_calibrated_list)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Creating a new wirc_data object from file wirc0140.fits
Found a J-band filter in the header of file wirc0140.fits
Saving a wirc_object to /Users/maxwellmb/Dropbox (Personal)/Library/Python/wirc_drp/Tutorial/sample_data/wirc0140_calib.fits
Creating a new wirc_data object from file wirc0141.fits
Found a J-band filter in the header of file wirc0141.fits
Saving a wirc_object to /Users/maxwellmb/Dropbox (Personal)/Library/Python/wirc_drp/Tutorial/sample_data/wirc0141_calib.fits
Creating a new wirc_data object from file wirc0142.fits
Found a J-band filter in the header of file wirc0142.fits
Saving a wirc_object to /Users/maxwellmb/Dropbox (Personal)/Library/Python/wirc_drp/Tutorial/sample_data/wirc0142_calib.fits
</pre></div></div>
</div>
</div>
<div class="section" id="Now-it’s-your-turn-to-set-up-a-loop-to-calibrate-the-brown-dwarf-data!">
<h3>Now it’s your turn to set up a loop to calibrate the brown dwarf data!<a class="headerlink" href="#Now-it’s-your-turn-to-set-up-a-loop-to-calibrate-the-brown-dwarf-data!" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">################ Brown Dwarf calibraton goes here ################</span>

<span class="n">BD_calib_dir</span> <span class="o">=</span> <span class="n">tutorial_dir</span><span class="o">+</span><span class="s1">&#39;/sample_data/&#39;</span>

<span class="n">BD_calibrated_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="c1">#This is a list of the calibrated files.</span>

<span class="c1">#First we&#39;ll set up all the directories and filenames:</span>
<span class="n">BD_filelist</span> <span class="o">=</span> <span class="s1">&#39;SIMP0136_sci.list&#39;</span> <span class="c1">#for the source, the brown dwarf here</span>

<span class="c1">#Read in the file names</span>
<span class="n">BD_fnames</span>  <span class="o">=</span> <span class="n">asci</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">BD_filelist</span> <span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;fast_no_header&#39;</span><span class="p">)[</span><span class="s1">&#39;col1&#39;</span><span class="p">]</span>
<span class="c1">#source_fnames = asci.read(source_filelist, format = &#39;fast_no_header&#39;)[&#39;col1&#39;]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">BD_fnames</span><span class="p">):</span>
    <span class="c1">#open the file</span>
    <span class="n">raw_data</span> <span class="o">=</span> <span class="n">wo</span><span class="o">.</span><span class="n">wirc_data</span><span class="p">(</span><span class="n">raw_filename</span><span class="o">=</span><span class="n">BD_fnames</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">flat_fn</span> <span class="o">=</span> <span class="n">flat_fn</span><span class="p">,</span> <span class="n">dark_fn</span> <span class="o">=</span> <span class="n">dark_name60s_1</span><span class="p">,</span> <span class="n">bp_fn</span> <span class="o">=</span> <span class="n">bp_fn</span><span class="p">)</span>
    <span class="c1">#run the calibration</span>
    <span class="n">raw_data</span><span class="o">.</span><span class="n">calibrate</span><span class="p">(</span><span class="n">mask_bad_pixels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1">#file name of the calibrated file</span>
    <span class="n">outname</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_calib.fits&#39;</span>
    <span class="c1">#add to the list and save it</span>
    <span class="n">BD_calibrated_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BD_calibrated_list</span><span class="p">,</span> <span class="n">BD_calib_dir</span><span class="o">+</span><span class="n">outname</span><span class="p">)</span>
    <span class="n">raw_data</span><span class="o">.</span><span class="n">save_wirc_object</span><span class="p">(</span><span class="n">BD_calib_dir</span><span class="o">+</span><span class="n">outname</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">raw_data</span><span class="o">.</span><span class="n">full_image</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>

<span class="c1">###You may want to save the list, for late use, here&#39;s an example how:</span>
<span class="c1"># np.save(BD_calib_dir+&#39;BD_calibrated_list.npy&#39;, BD_calibrated_list)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Creating a new wirc_data object from file wirc0158.fits
Found a J-band filter in the header of file wirc0158.fits
Saving a wirc_object to /Users/maxwellmb/Dropbox (Personal)/Library/Python/wirc_drp/Tutorial/sample_data/wirc0158_calib.fits
Creating a new wirc_data object from file wirc0159.fits
Found a J-band filter in the header of file wirc0159.fits
Saving a wirc_object to /Users/maxwellmb/Dropbox (Personal)/Library/Python/wirc_drp/Tutorial/sample_data/wirc0159_calib.fits
Creating a new wirc_data object from file wirc0160.fits
Found a J-band filter in the header of file wirc0160.fits
Saving a wirc_object to /Users/maxwellmb/Dropbox (Personal)/Library/Python/wirc_drp/Tutorial/sample_data/wirc0160_calib.fits
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_18_1.png" src="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_18_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_18_2.png" src="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_18_2.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_18_3.png" src="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_18_3.png" />
</div>
</div>
</div>
<div class="section" id="Step-2:-Source-identification">
<h3>Step 2: Source identification<a class="headerlink" href="#Step-2:-Source-identification" title="Permalink to this headline">¶</a></h3>
<p>In this step we will create s wircpol_source object and attach it to each wirc_pol data object. Each source object will contain cutout thumbnails of each spectral trace, and eventually spectra and polarized spectra. We will then append the wircpol_source object to the wirc object’s “source_list”.</p>
<p>Again, we will show this step for one file first, then we will show steps 3-4 for this file. In the end we will loop through and do this for every file.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#First we&#39;ll create a new data object, mostly just to demonstrate how to read in an existing wirc_data object.</span>
<span class="n">calibrated_data</span> <span class="o">=</span> <span class="n">wo</span><span class="o">.</span><span class="n">wirc_data</span><span class="p">(</span><span class="n">wirc_object_filename</span><span class="o">=</span><span class="n">BD_calibrated_list</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Loading a wirc_data object from file /Users/maxwellmb/Dropbox (Personal)/Library/Python/wirc_drp/Tutorial/sample_data/wirc0159_calib.fits
</pre></div></div>
</div>
<p>Generate a background image by scaling the “calibrated” image from the _Single_File tutorial</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">calibrated_data</span><span class="o">.</span><span class="n">generate_bkg</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;scaled_bkg&quot;</span><span class="p">,</span><span class="n">bkg_fns</span><span class="o">=</span><span class="p">[</span><span class="n">tutorial_dir</span><span class="o">+</span><span class="s2">&quot;/calibrated.fits&quot;</span><span class="p">],</span><span class="n">same_HWP</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Put in the coordinates of the source here, then add source to the wirc_data object</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">source_coords</span> <span class="o">=</span> <span class="p">[</span><span class="mi">700</span><span class="p">,</span> <span class="mi">955</span><span class="p">]</span> <span class="c1">#X, Y position of the zeroth order of the source (undispersed star in the center)</span>

<span class="c1"># This function add the source to our wirc_data object created in the last cell.</span>
<span class="c1"># update_w_chi2_shift flag centers the source</span>
<span class="n">calibrated_data</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span> <span class="n">source_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">source_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">slit_pos</span> <span class="o">=</span> <span class="s2">&quot;slitless&quot;</span><span class="p">,</span> <span class="n">update_w_chi2_shift</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># We can access the source from the source list attribute</span>
<span class="n">wp_source</span> <span class="o">=</span> <span class="n">calibrated_data</span><span class="o">.</span><span class="n">source_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Loading Template from /Users/maxwellmb/Dropbox (Personal)/Library/Python/wirc_drp/wirc_drp/masks/single_trace_template2.fits
Shfits are x,y =  [3.314453125, 1.751953125, 0.052734375, 0.052734375]
Applying shifts
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/maxwellmb/Dropbox (Personal)/Library/Python/image_registration/build/lib.macosx-10.7-x86_64-3.7/image_registration/fft_tools/zoom.py:101: FutureWarning: Using a non-tuple sequence for multidimensional indexing is deprecated; use `arr[tuple(seq)]` instead of `arr[seq]`. In the future this will be interpreted as an array index, `arr[np.array(seq)]`, which will result either in an error or a different result.
  outarr[ii] = outarr_d[dims]
</pre></div></div>
</div>
<p>We’ll now get the trace cutouts for this source</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">wp_source</span><span class="o">.</span><span class="n">get_cutouts</span><span class="p">(</span><span class="n">calibrated_data</span><span class="o">.</span><span class="n">full_image</span><span class="p">,</span> <span class="n">calibrated_data</span><span class="o">.</span><span class="n">DQ_image</span><span class="p">,</span> <span class="n">calibrated_data</span><span class="o">.</span><span class="n">filter_name</span><span class="p">,</span>
                      <span class="n">calibrated_data</span><span class="o">.</span><span class="n">bkg_image</span><span class="p">,</span> <span class="n">replace_bad_pixels</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">sub_bar</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cutout_size</span> <span class="o">=</span> <span class="mi">75</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Source 1&#39;s traces will hit the vertical bar of doom, compensating by subtracting the median of the edges of each row
Source 1&#39;s traces will hit the vertical bar of doom, compensating by subtracting the median of the edges of each row
</pre></div></div>
</div>
<p>Plot the cutouts</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">wp_source</span><span class="o">.</span><span class="n">plot_cutouts</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">200</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_28_0.png" src="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_28_0.png" />
</div>
</div>
<p>Plot the background-subtracted cutouts</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">wp_source</span><span class="o">.</span><span class="n">plot_cutouts</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="n">plot_bkg_sub</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">500</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_30_0.png" src="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_30_0.png" />
</div>
</div>
<p>This background subtraction has clearly introduced some features into the image that aren’t ideal, but in a real observation set you will have taken more appropriate background images. There are also several different background subgraction options that you can experiment with within the <strong>wircpol_data.generate_bkg()</strong> functions that may improve your results.</p>
</div>
<div class="section" id="Step-3-4:-Background-subtraction-and-spectral-extraction">
<h3>Step 3-4: Background subtraction and spectral extraction<a class="headerlink" href="#Step-3-4:-Background-subtraction-and-spectral-extraction" title="Permalink to this headline">¶</a></h3>
<p>In this step we will subtract background and extract the specta from one of the source objects we found in Step 2. Options for the spectral extraction function are pretty extensive, but here are all you need to care about:</p>
<p><strong>method</strong> is how we exactly extract the spectra. We are using optimal extraction here and you can read about it in Horne 1986. <strong>spatial_sigma</strong> is how far in the wings of the spectral trace we want to extract.</p>
<p>Here we’ll plot some of the internal workings for each trace. Each trace goes through 2 iterations of the optimal extraction algorithm. The orange and blue lines show the regions defined by the <strong>spatial_sigma</strong> parameter.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">calibrated_data</span><span class="o">.</span><span class="n">source_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">extract_spectra</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;optimal_extraction&quot;</span><span class="p">,</span>
                                   <span class="n">spatial_sigma</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                   <span class="n">bad_pix_masking</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                                   <span class="n">plot_optimal_extraction</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                   <span class="n">plot_findTrace</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                   <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_33_0.png" src="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_33_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_33_1.png" src="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_33_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_33_2.png" src="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_33_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_33_3.png" src="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_33_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_33_4.png" src="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_33_4.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_33_5.png" src="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_33_5.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_33_6.png" src="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_33_6.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_33_7.png" src="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_33_7.png" />
</div>
</div>
<p>Now let’s plot the spectra:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">calibrated_data</span><span class="o">.</span><span class="n">source_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot_trace_spectra</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_35_0.png" src="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_35_0.png" />
</div>
</div>
<p>It is clear that these spectra are messed up, and it’s related to the background levels. This is a work in progress (and one of the reasons we suggest that you don’t use your data for science without talking to the instrument team).</p>
</div>
<div class="section" id="Now-with-Steps-2-4-demonstrated-for-one-file,-let’s-run-it-all-on-all-files:-First-with-the-unpolarized-standard-star">
<h3>Now with Steps 2-4 demonstrated for one file, let’s run it all on all files: First with the unpolarized standard star<a class="headerlink" href="#Now-with-Steps-2-4-demonstrated-for-one-file,-let’s-run-it-all-on-all-files:-First-with-the-unpolarized-standard-star" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">source_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">all_spec_cube</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">fn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unpol_calibrated_list</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Extracting from file </span><span class="si">{}</span><span class="s2"> of </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unpol_calibrated_list</span><span class="p">)))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">wo</span><span class="o">.</span><span class="n">wirc_data</span><span class="p">(</span><span class="n">wirc_object_filename</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">full_image</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">data</span><span class="o">.</span><span class="n">generate_bkg</span><span class="p">()</span>

        <span class="c1">#Clear the source list</span>
        <span class="n">data</span><span class="o">.</span><span class="n">source_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data</span><span class="o">.</span><span class="n">n_sources</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">data</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span> <span class="n">source_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">source_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">slit_pos</span> <span class="o">=</span> <span class="s2">&quot;slitless&quot;</span><span class="p">,</span>
                        <span class="n">update_w_chi2_shift</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1">#Let&#39;s save ourselves from million plots</span>
        <span class="n">do_plot</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#Get cutouts of the 4 spectra and plot them for every 10 frames</span>
        <span class="n">data</span><span class="o">.</span><span class="n">source_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_cutouts</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">full_image</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">DQ_image</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">filter_name</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">bkg_image</span><span class="p">,</span>
                                        <span class="n">replace_bad_pixels</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                        <span class="n">sub_bar</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cutout_size</span> <span class="o">=</span> <span class="mi">75</span><span class="p">)</span>
<span class="c1">#         if do_plot == True:</span>
<span class="c1">#             data.source_list[0].plot_cutouts(origin =&#39;lower&#39;)</span>
        <span class="c1">#Now extract the spectra</span>
        <span class="n">data</span><span class="o">.</span><span class="n">source_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">extract_spectra</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;optimal_extraction&quot;</span><span class="p">,</span>
                                   <span class="n">bad_pix_masking</span> <span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                   <span class="n">plot_optimal_extraction</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                    <span class="n">plot_findTrace</span> <span class="o">=</span> <span class="n">do_plot</span><span class="p">,</span>
                                   <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">spatial_sigma</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="c1">#Save the spectra in this array</span>
        <span class="n">all_spec_cube</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">source_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">trace_spectra</span><span class="p">)</span>
        <span class="c1">#Save the file</span>
        <span class="n">data</span><span class="o">.</span><span class="n">save_wirc_object</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">source_list</span> <span class="o">+=</span> <span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">source_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Some sort of Error, skipping file </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fn</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="c1"># trace_info = iu.locate_traces(im,sky, plot=False, verbose=True)</span>

<span class="n">source_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">source_list</span><span class="p">)</span>
<span class="n">up_all_spec_cube</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_spec_cube</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Extracting from file 1 of 3
Subtracting background using shift and subtract method.
Applying shifts
Source 1&#39;s traces will hit the vertical bar of doom, compensating by subtracting the median of the edges of each row
Source 1&#39;s traces will hit the vertical bar of doom, compensating by subtracting the median of the edges of each row
Saving a wirc_object to /Users/maxwellmb/Dropbox (Personal)/Library/Python/wirc_drp/Tutorial/sample_data/wirc0140_calib.fits
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING: VerifyWarning: Card is too long, comment will be truncated. [astropy.io.fits.card]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Extracting from file 2 of 3
Subtracting background using shift and subtract method.
Applying shifts
Source 1&#39;s traces will hit the vertical bar of doom, compensating by subtracting the median of the edges of each row
Source 1&#39;s traces will hit the vertical bar of doom, compensating by subtracting the median of the edges of each row
Saving a wirc_object to /Users/maxwellmb/Dropbox (Personal)/Library/Python/wirc_drp/Tutorial/sample_data/wirc0141_calib.fits
Extracting from file 3 of 3
Subtracting background using shift and subtract method.
Applying shifts
Source 1&#39;s traces will hit the vertical bar of doom, compensating by subtracting the median of the edges of each row
Source 1&#39;s traces will hit the vertical bar of doom, compensating by subtracting the median of the edges of each row
Saving a wirc_object to /Users/maxwellmb/Dropbox (Personal)/Library/Python/wirc_drp/Tutorial/sample_data/wirc0142_calib.fits
</pre></div></div>
</div>
</div>
<div class="section" id="Then-the-brown-dwarf">
<h3>Then the brown dwarf<a class="headerlink" href="#Then-the-brown-dwarf" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">source_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">BD_all_spec_cube</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">fn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">BD_calibrated_list</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Extracting from file </span><span class="si">{}</span><span class="s2"> of </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">BD_calibrated_list</span><span class="p">)))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">wo</span><span class="o">.</span><span class="n">wirc_data</span><span class="p">(</span><span class="n">wirc_object_filename</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">generate_bkg</span><span class="p">()</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">full_image</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1">#Clear the source list</span>
        <span class="n">data</span><span class="o">.</span><span class="n">source_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data</span><span class="o">.</span><span class="n">n_sources</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">data</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span> <span class="n">source_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">source_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">slit_pos</span> <span class="o">=</span> <span class="s2">&quot;slitless&quot;</span><span class="p">,</span>
                        <span class="n">update_w_chi2_shift</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="c1">#Let&#39;s save ourselves from million plots</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="k">10</span> == 0:
            <span class="n">do_plot</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">do_plot</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1">#Get cutouts of the 4 spectra and plot them for every 10 frames</span>
        <span class="n">data</span><span class="o">.</span><span class="n">source_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_cutouts</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">full_image</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">DQ_image</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">filter_name</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">bkg_image</span><span class="p">,</span>
                                        <span class="n">replace_bad_pixels</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                        <span class="n">sub_bar</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cutout_size</span> <span class="o">=</span> <span class="mi">75</span><span class="p">)</span>
<span class="c1">#         if do_plot == True:</span>
<span class="c1">#             data.source_list[0].plot_cutouts(origin =&#39;lower&#39;)</span>
        <span class="c1">#Now extract the spectra</span>
        <span class="n">data</span><span class="o">.</span><span class="n">source_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">extract_spectra</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;optimal_extraction&quot;</span><span class="p">,</span>
                                   <span class="n">bad_pix_masking</span> <span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                   <span class="n">plot_optimal_extraction</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                    <span class="n">plot_findTrace</span> <span class="o">=</span> <span class="n">do_plot</span><span class="p">,</span>
                                   <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">spatial_sigma</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="c1">#Save the spectra in this array</span>
        <span class="n">BD_all_spec_cube</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">source_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">trace_spectra</span><span class="p">)</span>
        <span class="c1">#Save the file</span>
        <span class="n">data</span><span class="o">.</span><span class="n">save_wirc_object</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">source_list</span> <span class="o">+=</span> <span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">source_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Some sort of Error, skipping file </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fn</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="c1"># trace_info = iu.locate_traces(im,sky, plot=False, verbose=True)</span>

<span class="n">source_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">source_list</span><span class="p">)</span>
<span class="n">BD_up_all_spec_cube</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">BD_all_spec_cube</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Extracting from file 1 of 3
Subtracting background using shift and subtract method.
Applying shifts
Source 1&#39;s traces will hit the vertical bar of doom, compensating by subtracting the median of the edges of each row
Source 1&#39;s traces will hit the vertical bar of doom, compensating by subtracting the median of the edges of each row
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_40_1.png" src="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_40_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_40_2.png" src="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_40_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_40_3.png" src="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_40_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_40_4.png" src="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_40_4.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Saving a wirc_object to /Users/maxwellmb/Dropbox (Personal)/Library/Python/wirc_drp/Tutorial/sample_data/wirc0158_calib.fits
Extracting from file 2 of 3
Subtracting background using shift and subtract method.
Applying shifts
Source 1&#39;s traces will hit the vertical bar of doom, compensating by subtracting the median of the edges of each row
Source 1&#39;s traces will hit the vertical bar of doom, compensating by subtracting the median of the edges of each row
Saving a wirc_object to /Users/maxwellmb/Dropbox (Personal)/Library/Python/wirc_drp/Tutorial/sample_data/wirc0159_calib.fits
Extracting from file 3 of 3
Subtracting background using shift and subtract method.
Applying shifts
Source 1&#39;s traces will hit the vertical bar of doom, compensating by subtracting the median of the edges of each row
Source 1&#39;s traces will hit the vertical bar of doom, compensating by subtracting the median of the edges of each row
Saving a wirc_object to /Users/maxwellmb/Dropbox (Personal)/Library/Python/wirc_drp/Tutorial/sample_data/wirc0160_calib.fits
</pre></div></div>
</div>
</div>
<div class="section" id="Step-5---Stack-the-spectra">
<h3>Step 5 - Stack the spectra<a class="headerlink" href="#Step-5---Stack-the-spectra" title="Permalink to this headline">¶</a></h3>
<p>Here we simply align spectra from all the exposures, scale and median combine them.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Align the spectra.</span>
<span class="n">up_aligned_cube</span> <span class="o">=</span> <span class="n">su</span><span class="o">.</span><span class="n">align_spectral_cube</span><span class="p">(</span><span class="n">up_all_spec_cube</span><span class="p">)</span>

<span class="c1">#Scale the spectra to compensate for atmospheric variation - you may not want to do this all the time</span>
<span class="n">up_scaled_cube</span> <span class="o">=</span> <span class="n">su</span><span class="o">.</span><span class="n">scale_and_combine_spectra</span><span class="p">(</span><span class="n">up_aligned_cube</span><span class="p">,</span> <span class="n">return_scaled_cube</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Plot them. The top plots are raw extraction, bottom are aligned and scaled.</span>
<span class="c1">#The left plots are upper left, lower right (U pair), and right plots are Q pair.</span>
<span class="c1">### What do the spectra look like</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">low_ind</span> <span class="o">=</span>  <span class="mi">0</span>
<span class="n">high_ind</span> <span class="o">=</span> <span class="mi">180</span>

<span class="n">cm1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;bwr&#39;</span><span class="p">)</span>
<span class="n">cm2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;copper&#39;</span><span class="p">)</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">up_all_spec_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">up_all_spec_cube</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">)</span> <span class="c1">#top left</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">up_all_spec_cube</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">)</span> <span class="c1">#bottom right</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">up_all_spec_cube</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">)</span> <span class="c1">#top right</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">up_all_spec_cube</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">)</span> <span class="c1">#bottom left</span>

    <span class="c1">#aligned and scaled cube</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">up_scaled_cube</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">)</span> <span class="c1">#top left</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">up_scaled_cube</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">)</span> <span class="c1">#bottom right</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">up_scaled_cube</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">)</span> <span class="c1">#top right</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">up_scaled_cube</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">)</span> <span class="c1">#bottom left</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">low_ind</span><span class="p">,</span> <span class="n">high_ind</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">low_ind</span><span class="p">,</span> <span class="n">high_ind</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">low_ind</span><span class="p">,</span> <span class="n">high_ind</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">low_ind</span><span class="p">,</span> <span class="n">high_ind</span><span class="p">])</span>
<span class="c1"># ax[0,0].set_ylim([0, 180000])</span>
<span class="c1"># ax[0,1].set_ylim([0, 150000])</span>
<span class="c1"># ax[1,0].set_ylim([0, 180000])</span>
<span class="c1"># ax[1,1].set_ylim([0, 150000])</span>


<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Top Left and Bottom Right, raw extraction&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Top Right and Bottom Left, raw extraction&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Top left and Bottom Right, aligned and scaled&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Top Right and Bottom Left, aligned and scaled&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;Top Right and Bottom Left, aligned and scaled&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_43_1.png" src="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_43_1.png" />
</div>
</div>
<p>We can now median combine and compute standard deviation of the measurement.</p>
<p>The most manual step here is to make sure the 4 spectra are aligned in wavelength, this is caused by the tilt of the J-band filter. The offsets given below are good, but let’s plot them to check.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sshift_um</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">sshift_up</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.2</span>
<span class="n">sshift_qm</span> <span class="o">=</span> <span class="o">+</span><span class="mf">0.7</span>
<span class="n">sshift_qp</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.5</span>

<span class="n">unpol_um_med</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">up_scaled_cube</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">sshift_um</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">unpol_up_med</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">up_scaled_cube</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">sshift_up</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">unpol_qm_med</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">up_scaled_cube</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">sshift_qm</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">unpol_qp_med</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">up_scaled_cube</span><span class="p">[:,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">sshift_qp</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">unpol_um_std</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">up_scaled_cube</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">up_scaled_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">sshift_um</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">unpol_up_std</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">up_scaled_cube</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">up_scaled_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">sshift_up</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">unpol_qm_std</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">up_scaled_cube</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">up_scaled_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">sshift_qm</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">unpol_qp_std</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">up_scaled_cube</span><span class="p">[:,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">up_scaled_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">sshift_qp</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mf">7.5</span><span class="p">,</span><span class="mf">7.5</span><span class="p">))</span>
<span class="n">vector</span> <span class="o">=</span> <span class="p">[</span><span class="n">unpol_qp_med</span><span class="p">,</span><span class="n">unpol_qm_med</span><span class="p">,</span><span class="n">unpol_up_med</span><span class="p">,</span><span class="n">unpol_um_med</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Qp&#39;</span><span class="p">,</span><span class="s1">&#39;Qm&#39;</span><span class="p">,</span><span class="s1">&#39;Up&#39;</span><span class="p">,</span><span class="s1">&#39;Um&#39;</span><span class="p">]</span>
<span class="n">factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">unpol_qp_med</span><span class="p">[</span><span class="mi">50</span><span class="p">:</span><span class="mi">110</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">50</span><span class="p">:</span><span class="mi">110</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">vector</span><span class="p">])</span>
<span class="n">factors</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">factors</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">1.015</span>
<span class="n">factors</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">factors</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mf">0.995</span>
<span class="n">factors</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">factors</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="mf">1.005</span>
<span class="n">fmts</span> <span class="o">=</span>   <span class="p">[</span><span class="s1">&#39;-b&#39;</span><span class="p">,</span><span class="s1">&#39;-r&#39;</span><span class="p">,</span><span class="s1">&#39;--b&#39;</span><span class="p">,</span><span class="s1">&#39;--r&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vector</span><span class="p">)):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vector</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">factors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">fmts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="c1"># plt.xlim([low_ind, high_ind])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">low_ind</span><span class="p">,</span> <span class="n">high_ind</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">])</span>
<span class="c1">#plt.ylim([100000,140000])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Spectral pixel&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Counts&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Four traces of unpolarized standard&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;Four traces of unpolarized standard&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_47_1.png" src="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_47_1.png" />
</div>
</div>
<p>Each trace corresponds to Stokes parameters as following: Qp – Bottom left; Qm – Top right; Up – Bottom right; Um – Top left.</p>
<p>These are such that normalized Stokes parameters are q = (Qp - Qm)/(Qp + Qm) and u = (Up - Um)/(Up + Um)</p>
</div>
<div class="section" id="Now-do-the-same-for-the-brown-dwarf">
<h3>Now do the same for the brown dwarf<a class="headerlink" href="#Now-do-the-same-for-the-brown-dwarf" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">BD_up_aligned_cube</span> <span class="o">=</span> <span class="n">su</span><span class="o">.</span><span class="n">align_spectral_cube</span><span class="p">(</span><span class="n">BD_up_all_spec_cube</span><span class="p">)</span>
<span class="n">BD_up_scaled_cube</span> <span class="o">=</span> <span class="n">su</span><span class="o">.</span><span class="n">scale_and_combine_spectra</span><span class="p">(</span><span class="n">BD_up_aligned_cube</span><span class="p">,</span> <span class="n">return_scaled_cube</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">fig1</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">low_ind</span> <span class="o">=</span>  <span class="mi">0</span>
<span class="n">high_ind</span> <span class="o">=</span> <span class="mi">170</span>

<span class="n">cm1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;bwr&#39;</span><span class="p">)</span>
<span class="n">cm2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;copper&#39;</span><span class="p">)</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">BD_up_all_spec_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">ax1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">BD_up_all_spec_cube</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">)</span> <span class="c1">#top left</span>
    <span class="n">ax1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">BD_up_all_spec_cube</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">)</span> <span class="c1">#bottom right</span>
    <span class="n">ax1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">BD_up_all_spec_cube</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">)</span> <span class="c1">#top right</span>
    <span class="n">ax1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">BD_up_all_spec_cube</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">)</span> <span class="c1">#bottom left</span>

    <span class="c1">#aligned and scaled cube</span>
    <span class="n">ax1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">BD_up_scaled_cube</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">)</span> <span class="c1">#top left</span>
    <span class="n">ax1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">BD_up_scaled_cube</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">)</span> <span class="c1">#bottom right</span>
    <span class="n">ax1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">BD_up_scaled_cube</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">)</span> <span class="c1">#top right</span>
    <span class="n">ax1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">BD_up_scaled_cube</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">)</span> <span class="c1">#bottom left</span>

<span class="n">ax1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">low_ind</span><span class="p">,</span> <span class="n">high_ind</span><span class="p">])</span>
<span class="n">ax1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">low_ind</span><span class="p">,</span> <span class="n">high_ind</span><span class="p">])</span>
<span class="n">ax1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">low_ind</span><span class="p">,</span> <span class="n">high_ind</span><span class="p">])</span>
<span class="n">ax1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">low_ind</span><span class="p">,</span> <span class="n">high_ind</span><span class="p">])</span>
<span class="c1">#ax1[0,0].set_ylim([0, 180000])</span>
<span class="c1">#ax1[0,1].set_ylim([0, 150000])</span>
<span class="c1">#ax1[1,0].set_ylim([0, 180000])</span>
<span class="c1">#ax1[1,1].set_ylim([0, 150000])</span>


<span class="n">ax1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Top Left and Bottem Right, raw extraction&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Top Right and Bottem Left, raw extraction&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Top left and Bottem Right, aligned and scaled&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Top Right and Bottem Left, aligned and scaled&#39;</span><span class="p">)</span>


</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;Top Right and Bottem Left, aligned and scaled&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_50_1.png" src="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_50_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#now shifts for the BD spectra</span>
<span class="n">sshift_um</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">sshift_up</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.2</span>
<span class="n">sshift_qm</span> <span class="o">=</span> <span class="o">+</span><span class="mf">0.7</span>
<span class="n">sshift_qp</span> <span class="o">=</span> <span class="o">+</span><span class="mi">1</span>

<span class="n">BD_um_med</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">BD_up_scaled_cube</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">sshift_um</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">BD_up_med</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">BD_up_scaled_cube</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">sshift_up</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">BD_qm_med</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">BD_up_scaled_cube</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">sshift_qm</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">BD_qp_med</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">BD_up_scaled_cube</span><span class="p">[:,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">sshift_qp</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">BD_um_std</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">BD_up_scaled_cube</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">BD_up_scaled_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">sshift_um</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">BD_up_std</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">BD_up_scaled_cube</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">BD_up_scaled_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">sshift_up</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">BD_qm_std</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">BD_up_scaled_cube</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">BD_up_scaled_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">sshift_qm</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">BD_qp_std</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">BD_up_scaled_cube</span><span class="p">[:,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">BD_up_scaled_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">sshift_qp</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mf">7.5</span><span class="p">,</span><span class="mf">7.5</span><span class="p">))</span>
<span class="n">vector</span> <span class="o">=</span> <span class="p">[</span><span class="n">BD_qp_med</span><span class="p">,</span><span class="n">BD_qm_med</span><span class="p">,</span><span class="n">BD_up_med</span><span class="p">,</span><span class="n">BD_um_med</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Qp&#39;</span><span class="p">,</span><span class="s1">&#39;Qm&#39;</span><span class="p">,</span><span class="s1">&#39;Up&#39;</span><span class="p">,</span><span class="s1">&#39;Um&#39;</span><span class="p">]</span>
<span class="n">factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">BD_qp_med</span><span class="p">[</span><span class="mi">40</span><span class="p">:</span><span class="mi">120</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">40</span><span class="p">:</span><span class="mi">120</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">vector</span><span class="p">])</span>
<span class="n">factors</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">factors</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">1.015</span>
<span class="n">factors</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">factors</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mf">0.995</span>
<span class="n">factors</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">factors</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="mf">1.005</span>
<span class="n">fmts</span> <span class="o">=</span>   <span class="p">[</span><span class="s1">&#39;-b&#39;</span><span class="p">,</span><span class="s1">&#39;-r&#39;</span><span class="p">,</span><span class="s1">&#39;--b&#39;</span><span class="p">,</span><span class="s1">&#39;--r&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vector</span><span class="p">)):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vector</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">factors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">fmts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="c1"># plt.xlim([low_ind, high_ind])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">low_ind</span><span class="p">,</span> <span class="n">high_ind</span><span class="p">])</span>
<span class="c1">#plt.xlim([160,180])</span>
<span class="c1">#plt.ylim([100000,140000])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Spectral pixel&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Counts&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Four traces of Brown Dwarf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;Four traces of Brown Dwarf&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_51_1.png" src="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_51_1.png" />
</div>
</div>
<p><strong>Let’s now save out spectra to a numpy file.</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;BD_Spectra&quot;</span><span class="p">,</span><span class="n">BD_up_scaled_cube</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Step-6:-Polarization-calibration-and-calculation">
<h3>Step 6: Polarization calibration and calculation<a class="headerlink" href="#Step-6:-Polarization-calibration-and-calculation" title="Permalink to this headline">¶</a></h3>
<p><strong>Note, that if you’re using data from after March 2019 that uses the new awesome half-wave plate, then instead of reading this section, you should move on to the other tutorial: WIRC+Pol_Tutorial_3-Reducing_a_Modulation_Sequence</strong></p>
<p>Suggestions: The most crucial part here is to get wavelength to line up. This is a bit tricky since WIRC+Pol is slitless and there’s no easy way to get wavelength solution directly from the data.</p>
<p>We suggest that you align the brown dwarf spectra to those of the standard star <strong>trace by trace</strong> relying on the filter cutoffs. Note that different traces have difference filter cutoff.</p>
<p>From the last part, you would have the median spectra: unpol_qp_med, unpol_qm_med and pol_qp_med, pol_qm_med from the standard and the brown dwarf respectively.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#First compute q, u from the unpolarized star. This is the instrumental polarization</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">q_inst</span> <span class="o">=</span> <span class="p">(</span><span class="n">unpol_qp_med</span> <span class="o">-</span> <span class="n">unpol_qm_med</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">unpol_qp_med</span> <span class="o">+</span> <span class="n">unpol_qm_med</span><span class="p">)</span>
<span class="n">u_inst</span> <span class="o">=</span> <span class="p">(</span><span class="n">unpol_up_med</span> <span class="o">-</span> <span class="n">unpol_um_med</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">unpol_up_med</span> <span class="o">+</span> <span class="n">unpol_um_med</span><span class="p">)</span>

<span class="c1"># Uncertainties, fill this in!</span>

<span class="n">q_inst_err</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">unpol_qp_med</span><span class="o">+</span><span class="n">unpol_qm_med</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">unpol_qp_med</span><span class="o">*</span><span class="n">unpol_qm_std</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">unpol_qm_med</span><span class="o">*</span><span class="n">unpol_qp_std</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
<span class="n">u_inst_err</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">unpol_up_med</span><span class="o">+</span><span class="n">unpol_um_med</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">unpol_up_med</span><span class="o">*</span><span class="n">unpol_um_std</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">unpol_um_med</span><span class="o">*</span><span class="n">unpol_up_std</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/maxwellmb/Anaconda3/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:5: RuntimeWarning: invalid value encountered in true_divide
  &#34;&#34;&#34;
/Users/maxwellmb/Anaconda3/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:6: RuntimeWarning: invalid value encountered in true_divide

/Users/maxwellmb/Anaconda3/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:10: RuntimeWarning: divide by zero encountered in true_divide
  # Remove the CWD from sys.path while we load stuff.
/Users/maxwellmb/Anaconda3/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:10: RuntimeWarning: invalid value encountered in multiply
  # Remove the CWD from sys.path while we load stuff.
/Users/maxwellmb/Anaconda3/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:11: RuntimeWarning: divide by zero encountered in true_divide
  # This is added back by InteractiveShellApp.init_path()
/Users/maxwellmb/Anaconda3/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:11: RuntimeWarning: invalid value encountered in multiply
  # This is added back by InteractiveShellApp.init_path()
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#show this</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">q_inst</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">u_inst</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span><span class="mi">120</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span><span class="mi">120</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Spectral pixel&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Spectral pixel&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;q (%)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;u (%)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;u (%)&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_56_1.png" src="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_56_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#### Do the same for the Brown Dwarf ####</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">q_BD_raw</span> <span class="o">=</span> <span class="p">(</span><span class="n">BD_qp_med</span> <span class="o">-</span> <span class="n">BD_qm_med</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">BD_qp_med</span> <span class="o">+</span> <span class="n">BD_qm_med</span><span class="p">)</span>
<span class="n">u_BD_raw</span> <span class="o">=</span> <span class="p">(</span><span class="n">BD_up_med</span> <span class="o">-</span> <span class="n">BD_um_med</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">BD_up_med</span> <span class="o">+</span> <span class="n">BD_um_med</span><span class="p">)</span>

<span class="c1"># Uncertainties, fill this in!</span>

<span class="n">q_BD_raw_err</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">BD_qp_med</span><span class="o">+</span><span class="n">BD_qm_med</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">BD_qp_med</span><span class="o">*</span><span class="n">BD_qm_std</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">BD_qm_med</span><span class="o">*</span><span class="n">BD_qp_std</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
<span class="n">u_BD_raw_err</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">BD_up_med</span><span class="o">+</span><span class="n">BD_um_med</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">BD_up_med</span><span class="o">*</span><span class="n">BD_um_std</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">BD_um_med</span><span class="o">*</span><span class="n">BD_up_std</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>

<span class="c1">#Now subtract the instrumental polarization</span>
<span class="n">q_BD_corrected</span> <span class="o">=</span>  <span class="n">q_BD_raw</span> <span class="o">-</span> <span class="n">q_inst</span>
<span class="n">u_BD_corrected</span> <span class="o">=</span>  <span class="n">u_BD_raw</span> <span class="o">-</span> <span class="n">u_inst</span>

<span class="n">q_BD_corrected_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">q_BD_raw_err</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">q_inst_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">u_BD_corrected_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u_BD_raw_err</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">u_inst_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/maxwellmb/Anaconda3/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:1: RuntimeWarning: invalid value encountered in true_divide
  &#34;&#34;&#34;Entry point for launching an IPython kernel.
/Users/maxwellmb/Anaconda3/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:6: RuntimeWarning: divide by zero encountered in true_divide

/Users/maxwellmb/Anaconda3/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:6: RuntimeWarning: invalid value encountered in multiply

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">### Plot q_BD_raw, q_BD_corrected here</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="n">x</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">q_BD_raw</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">q_BD_raw</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;-b&#39;</span><span class="p">)</span>
<span class="c1">#ax[0].plot(q_BD_corrected*100,&#39;-r&#39;)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">u_BD_raw</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;b-&#39;</span><span class="p">)</span>
<span class="c1">#ax[1].plot(u_BD_corrected*100,&#39;-r&#39;)</span>

<span class="c1">#ax[0].set_xlim([100,200])</span>
<span class="c1">#ax[1].set_xlim([100,200])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span><span class="mi">15</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span><span class="mi">15</span><span class="p">])</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Spectral pixel&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Spectral pixel&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;q (%)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;u (%)&#39;</span><span class="p">)</span>

<span class="c1">#q here</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">q_BD_corrected</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">q_BD_corrected_err</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
<span class="c1">#u here</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">u_BD_corrected</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">u_BD_corrected_err</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;ErrorbarContainer object of 3 artists&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_59_1.png" src="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_59_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#### Finally, compute degree and angle of polarization</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">q_BD_corrected</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">u_BD_corrected</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">theta</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u_BD_corrected</span><span class="p">,</span> <span class="n">q_BD_corrected</span><span class="p">)</span>

<span class="c1">#uncertainties</span>

<span class="n">p_err</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">q_BD_corrected</span><span class="o">*</span><span class="n">q_BD_corrected_err</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">u_BD_corrected</span><span class="o">*</span><span class="n">u_BD_corrected_err</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># theta_err = (0.5/(1+(u_BD_corrected/q_BD_corrected)**2))*np.sqrt((u_BD_corrected_err/q_BD_corrected)**2 + (u_BD_corrected*q_BD_corrected_err/(q_BD_corrected**2))**2)</span>
<span class="n">theta_err</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">/</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">q_BD_corrected</span><span class="o">*</span><span class="n">u_BD_corrected_err</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">u_BD_corrected</span><span class="o">*</span><span class="n">q_BD_corrected_err</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">#plot these!</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="n">x</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">q_BD_raw</span><span class="p">))</span>
<span class="c1"># ax[0].plot(x,p*100,&#39;-b&#39;)</span>
<span class="c1"># ax[1].plot(x,theta,&#39;b-&#39;)</span>
<span class="c1">#ax[1].plot(u_BD_corrected*100,&#39;-r&#39;)</span>

<span class="c1">#ax[0].set_xlim([100,200])</span>
<span class="c1">#ax[1].set_xlim([100,200])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Spectral pixel&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Spectral pixel&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;p (%)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Theta (degred)&#39;</span><span class="p">)</span>

<span class="c1">#q here</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">p</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">p_err</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
<span class="c1">#u here</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span><span class="n">yerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">theta_err</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/maxwellmb/Anaconda3/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:8: RuntimeWarning: divide by zero encountered in true_divide

/Users/maxwellmb/Anaconda3/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:8: RuntimeWarning: invalid value encountered in multiply

/Users/maxwellmb/Anaconda3/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:10: RuntimeWarning: divide by zero encountered in true_divide
  # Remove the CWD from sys.path while we load stuff.
/Users/maxwellmb/Anaconda3/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:10: RuntimeWarning: invalid value encountered in multiply
  # Remove the CWD from sys.path while we load stuff.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_60_1.png" src="../_images/tutorials_WIRC+Pol_Tutorial_2-Reducing_a_Dataset_60_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Acknowledgement">
<h2>Acknowledgement<a class="headerlink" href="#Acknowledgement" title="Permalink to this headline">¶</a></h2>
<p>The data used in this Tutorial are taken by the Ay122a class in Fall 2018 with Prof. Dimitri Mawet. Class members are Aida, Anise, Anusha, Luiza, Nitika, Ryan, Yuhan, Yuping, Zhihui, and TA Jackie Pezzato. They contributed to making this Tutorial as well.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="WIRC+Pol_Tutorial_3-Reducing_a_Modulation_Sequence.html" class="btn btn-neutral float-right" title="Tutorial 3: WIRC+Pol Modulation Sequence Tutorial" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="WIRC+Pol_Tutorial_1-Single_File_Spectral_Extraction.html" class="btn btn-neutral float-left" title="Tutorial 1: WIRC+POL Single File Data Reduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Max Millar-Blanchaer, Kaew Tinyanont and others

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>